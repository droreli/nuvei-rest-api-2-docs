---
title: 'Events'
description: 'Complete reference for Simply Connect event callbacks'
---

# Simply Connect Events

Simply Connect emits events throughout the payment lifecycle. Use these callbacks to build reactive UIs, validate orders, and handle payment outcomes.

## Event Registration

Pass event handlers when calling `checkout()`:

```javascript
checkout({
  sessionToken: sessionToken,
  
  // Lifecycle events
  onReady: function() {},
  prePayment: function(paymentDetails) {},
  onResult: function(result) {},
  onError: function(error) {},
  
  // Form events
  onFormValidated: function(isValid) {},
  onPaymentFormChange: function(fieldData) {},
  
  // Selection events
  onSelectPaymentMethod: function(pm) {},
  onSuggestedAmount: function(amount) {},
  
  // UPO events
  upoDeleted: function(upoId) {},
  
  // Recovery events
  onDeclineRecovery: function(recoveryData) {},
  
  // Withdrawal events
  wdRequestCanceled: function(data) {}
});
```

---

## Critical Events

### prePayment

**The most important event for production integrations.** Called before payment submission, allowing server-side validation.

```javascript
checkout({
  prePayment: function(paymentDetails) {
    return new Promise((resolve, reject) => {
      // paymentDetails contains full payment context
      console.log('Payment details:', paymentDetails);
      
      // Validate with your server
      fetch('/api/validate-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          amount: paymentDetails.amount,
          currency: paymentDetails.currency,
          orderId: currentOrderId
        })
      })
      .then(response => {
        if (response.ok) {
          resolve();  // Continue with payment
        } else {
          reject('Order validation failed');  // Cancel payment
        }
      })
      .catch(error => {
        reject('Server error: ' + error.message);
      });
    });
  }
});
```

**paymentDetails Object:**

| Property | Type | Description |
|----------|------|-------------|
| `paymentOption` | object | Selected payment method details |
| `amount` | string | Transaction amount |
| `currency` | string | Currency code |
| `useDCC` | boolean | Whether DCC is selected |
| `dccDetails` | object | DCC conversion details (if applicable) |
| `savePM` | boolean | Whether saving payment method |
| `installmentType` | string | Installment type (if applicable) |
| `numberOfInstallments` | number | Number of installments |
| `promoCode` | string | Applied promo code |

**paymentOption Object (Card):**

```javascript
paymentOption: {
  card: {
    cardNumber: '4***1111',      // Masked
    cardHolderName: 'John Smith',
    expirationMonth: '12',
    expirationYear: '25',
    CVV: '***',                  // Masked
    brand: 'VISA',
    cardType: 'credit'
  }
}
```

**paymentOption Object (UPO):**

```javascript
paymentOption: {
  userPaymentOptionId: '12345678',
  card: {
    CVV: '***'
  }
}
```

**dccDetails Object:**

```javascript
dccDetails: {
  amount: '100.00',
  currency: 'USD',
  chargedAmount: '85.00',
  chargedCurrency: 'EUR',
  rate: '0.85',
  markup: '3.5%'
}
```

<Warning>
  **Always implement `prePayment` in production** to validate orders server-side before processing payment.
</Warning>

---

### onResult

Called when payment completes (success or failure).

```javascript
checkout({
  onResult: function(result) {
    console.log('Payment result:', result);
    
    switch (result.result) {
      case 'APPROVED':
        // Payment successful
        window.location.href = '/success?txId=' + result.transactionId;
        break;
        
      case 'DECLINED':
        // Payment declined
        showDeclineMessage(result.errorDescription);
        break;
        
      case 'PENDING':
        // APM pending completion
        showPendingMessage(result);
        break;
        
      case 'ERROR':
        // System error
        showErrorMessage(result.errorDescription);
        break;
    }
  }
});
```

**Result Object - Full Reference:**

| Property | Type | Description |
|----------|------|-------------|
| `result` | string | `APPROVED`, `DECLINED`, `PENDING`, `ERROR` |
| `transactionId` | string | Nuvei transaction ID |
| `transactionStatus` | string | Detailed status |
| `transactionType` | string | `Sale`, `Auth`, `PreAuth` |
| `authCode` | string | Authorization code |
| `orderId` | string | Your order ID |
| `clientUniqueId` | string | Your unique ID |
| `userPaymentOptionId` | string | Saved payment method ID |
| `paymentOption` | object | Payment method details |
| `amount` | string | Charged amount |
| `currency` | string | Transaction currency |
| `errorCode` | string | Error code (if failed) |
| `errorDescription` | string | Error message |

**3D Secure Fields (in result):**

| Property | Type | Description |
|----------|------|-------------|
| `threeDReason` | string | 3DS outcome reason |
| `threeDReasonId` | string | 3DS reason code |
| `eci` | string | Electronic Commerce Indicator |
| `cavv` | string | Cardholder Authentication Value |
| `dsTransID` | string | Directory Server Transaction ID |
| `isLiabilityOnIssuer` | string | `1` = liability shifted to issuer |
| `challengePreferenceReason` | string | Why challenge was/wasn't shown |

**Example Response (Approved):**

```javascript
{
  "result": "APPROVED",
  "transactionId": "711000000012345678",
  "transactionStatus": "APPROVED",
  "transactionType": "Sale",
  "authCode": "123456",
  "orderId": "order_789",
  "userPaymentOptionId": "87654321",
  "amount": "100.00",
  "currency": "USD",
  "paymentOption": {
    "card": {
      "bin": "411111",
      "last4Digits": "1111",
      "ccCardNumber": "4***1111",
      "brand": "VISA"
    }
  },
  "eci": "05",
  "cavv": "AAABAWFlmQAAAABjRWWZEEFgFz8=",
  "dsTransID": "d65e93c3-35ab-41ba-b307-767bef3c7b8a",
  "threeDReason": "Authentication successful",
  "threeDReasonId": "1",
  "isLiabilityOnIssuer": "1"
}
```

---

### onError

Called when a system error occurs (not declined transactions).

```javascript
checkout({
  onError: function(error) {
    console.error('Payment error:', error);
    
    // Log for debugging
    logToServer({
      errorCode: error.errorCode,
      errorDescription: error.errorDescription,
      sessionToken: sessionToken,
      timestamp: new Date().toISOString()
    });
    
    // Show user-friendly message
    showErrorModal('An error occurred. Please try again.');
  }
});
```

**Error Object:**

| Property | Type | Description |
|----------|------|-------------|
| `errorCode` | string | Error identifier |
| `errorDescription` | string | Human-readable message |
| `errorSource` | string | `validation`, `api`, `network` |

---

## Form Events

### onReady

Called when the payment form has fully loaded.

```javascript
checkout({
  onReady: function() {
    // Hide loading spinner
    document.getElementById('loading').style.display = 'none';
    
    // Show payment form
    document.getElementById('payment-container').style.display = 'block';
    
    // Enable any dependent UI
    enableCheckoutButton();
  }
});
```

### onFormValidated

Called when form validation state changes.

```javascript
checkout({
  onFormValidated: function(isValid) {
    // Enable/disable external submit button
    document.getElementById('custom-submit').disabled = !isValid;
    
    if (isValid) {
      console.log('Form is valid');
    } else {
      console.log('Form has validation errors');
    }
  }
});
```

### onPaymentFormChange

Called when any form field value changes.

```javascript
checkout({
  onPaymentFormChange: function(fieldData) {
    console.log('Field changed:', fieldData);
    
    // Track card brand detection
    if (fieldData.fieldName === 'cardNumber' && fieldData.cardBrand) {
      updateCardBrandIcon(fieldData.cardBrand);
    }
    
    // Track completion progress
    updateFormProgress(fieldData);
  }
});
```

**fieldData Object:**

| Property | Type | Description |
|----------|------|-------------|
| `fieldName` | string | `cardNumber`, `cardHolderName`, `expirationDate`, `CVV` |
| `isEmpty` | boolean | Whether field is empty |
| `isValid` | boolean | Whether field value is valid |
| `cardBrand` | string | Detected card brand (for cardNumber) |
| `cardType` | string | `credit`, `debit`, `prepaid` |
| `errorMessage` | string | Validation error message |

---

## Selection Events

### onSelectPaymentMethod

Called when user selects a payment method.

```javascript
checkout({
  onSelectPaymentMethod: function(paymentMethod) {
    console.log('Selected:', paymentMethod);
    
    // Track analytics
    analytics.track('Payment Method Selected', {
      method: paymentMethod.paymentMethod,
      isStored: paymentMethod.isStored
    });
    
    // Update UI based on selection
    if (paymentMethod.paymentMethod === 'cc_card') {
      showCardTerms();
    } else if (paymentMethod.paymentMethod.startsWith('apmgw_')) {
      showApmInfo(paymentMethod.paymentMethod);
    }
  }
});
```

**paymentMethod Object:**

| Property | Type | Description |
|----------|------|-------------|
| `paymentMethod` | string | Method ID (e.g., `cc_card`, `apmgw_PayPal`) |
| `paymentMethodDisplayName` | string | Display name |
| `isStored` | boolean | Whether it's a saved method |
| `userPaymentOptionId` | string | UPO ID (if saved) |

### onSuggestedAmount

Called when user selects a suggested amount (with `openAmount` feature).

```javascript
checkout({
  openAmount: { min: '10', max: '500' },
  amountSuggestions: ['25', '50', '100'],
  
  onSuggestedAmount: function(amount) {
    console.log('User selected amount:', amount);
    
    // Update order total display
    updateOrderDisplay(amount);
  }
});
```

---

## UPO Events

### upoDeleted

Called when user deletes a saved payment method.

```javascript
checkout({
  upoDeleted: function(upoId) {
    console.log('UPO deleted:', upoId);
    
    // Update your backend
    fetch('/api/payment-methods/' + upoId, {
      method: 'DELETE'
    });
    
    // Update UI
    removePaymentMethodFromList(upoId);
    
    // Track analytics
    analytics.track('Payment Method Deleted', { upoId });
  }
});
```

---

## Recovery & Error Handling Events

### onDeclineRecovery

Called when decline recovery is triggered, allowing customization.

```javascript
checkout({
  onDeclineRecovery: function(recoveryData) {
    console.log('Decline recovery triggered:', recoveryData);
    
    // Customize recovery behavior
    return {
      showRecovery: true,              // Show recovery UI
      customMessage: 'Try another card or payment method',
      highlightAlternatives: ['apmgw_PayPal', 'apmgw_Apple_Pay']
    };
  }
});
```

**recoveryData Object:**

| Property | Type | Description |
|----------|------|-------------|
| `errorCode` | string | Decline error code |
| `errorDescription` | string | Decline reason |
| `suggestedActions` | array | Suggested recovery actions |

---

## 3D Secure Events

### on3DSStarted

Called when 3D Secure authentication begins.

```javascript
checkout({
  on3DSStarted: function(data) {
    console.log('3DS started, version:', data.version);
    
    // Show 3DS notification
    showNotification('Verifying with your bank...');
  }
});
```

### on3DSChallengeDisplayed

Called when 3DS challenge UI is shown.

```javascript
checkout({
  on3DSChallengeDisplayed: function(data) {
    console.log('3DS challenge shown');
    
    // Track for analytics
    analytics.track('3DS Challenge Displayed', {
      version: data.version
    });
  }
});
```

### on3DSComplete

Called when 3DS authentication completes (before final result).

```javascript
checkout({
  on3DSComplete: function(data) {
    console.log('3DS complete:', data.authenticationStatus);
    
    // Y = fully authenticated (liability shift)
    // A = attempted authentication
    // N = authentication failed
    // U = authentication unavailable
    
    if (data.authenticationStatus === 'N') {
      // Authentication failed, payment may still proceed
      console.log('3DS authentication failed');
    }
  }
});
```

**data Object:**

| Property | Type | Description |
|----------|------|-------------|
| `authenticationStatus` | string | `Y`, `A`, `N`, `U` |
| `version` | string | 3DS version used |
| `eci` | string | ECI value |

---

## APM Events

### onAPMRedirectStarted

Called before redirecting to external APM.

```javascript
checkout({
  onAPMRedirectStarted: function(data) {
    console.log('Redirecting to:', data.paymentMethodName);
    
    // Save state for return
    localStorage.setItem('pendingPayment', JSON.stringify({
      orderId: currentOrderId,
      timestamp: Date.now()
    }));
    
    // Show message
    showNotification('Redirecting to ' + data.paymentMethodName + '...');
  }
});
```

### onAPMPopupOpened

Called when APM opens in popup (when `apmWindowType: 'popup'`).

```javascript
checkout({
  apmWindowType: 'popup',
  
  onAPMPopupOpened: function(data) {
    showNotification('Complete payment in the popup window');
  }
});
```

### onAPMPopupClosed

Called when APM popup closes.

```javascript
checkout({
  onAPMPopupClosed: function(data) {
    if (!data.completed) {
      // User closed without completing
      showNotification('Payment was cancelled');
      enablePaymentForm();
    }
  }
});
```

---

## Withdrawal Events

### wdRequestCanceled

Called when a withdrawal request is cancelled.

```javascript
checkout({
  wdRequestCanceled: function(data) {
    console.log('Withdrawal cancelled:', data);
    
    // Restore user balance
    updateUserBalance();
    
    // Show confirmation
    showNotification('Withdrawal request cancelled');
  }
});
```

---

## userData Event

Hook for providing additional user data before payment.

```javascript
checkout({
  userData: function() {
    return new Promise((resolve) => {
      // Fetch user data from your system
      fetch('/api/user-profile')
        .then(r => r.json())
        .then(user => {
          resolve({
            billingAddress: {
              firstName: user.firstName,
              lastName: user.lastName,
              email: user.email,
              phone: user.phone,
              address: user.address,
              city: user.city,
              zip: user.zip,
              country: user.country
            },
            shippingAddress: user.shippingAddress,
            userDetails: {
              dateOfBirth: user.dob
            }
          });
        });
    });
  }
});
```

---

## Complete Event Handler Example

```javascript
const sc = SafeCharge({
  env: 'int',
  merchantId: '1234567890',
  merchantSiteId: '123456'
});

sc.checkout({
  sessionToken: sessionToken,
  amount: '100.00',
  currency: 'USD',
  
  // ===== LIFECYCLE EVENTS =====
  
  onReady: function() {
    hideLoadingSpinner();
    enablePayButton();
  },
  
  prePayment: function(paymentDetails) {
    return new Promise((resolve, reject) => {
      // Server-side validation
      fetch('/api/validate-order', {
        method: 'POST',
        body: JSON.stringify({
          orderId: currentOrderId,
          amount: paymentDetails.amount,
          currency: paymentDetails.currency
        })
      })
      .then(r => r.ok ? resolve() : reject('Validation failed'))
      .catch(e => reject(e.message));
    });
  },
  
  onResult: function(result) {
    hideLoadingOverlay();
    
    switch (result.result) {
      case 'APPROVED':
        analytics.track('Payment Success', {
          transactionId: result.transactionId,
          amount: result.amount
        });
        redirectToConfirmation(result);
        break;
        
      case 'DECLINED':
        analytics.track('Payment Declined', {
          errorCode: result.errorCode
        });
        showDeclineError(result);
        break;
        
      case 'PENDING':
        showPendingStatus(result);
        startPolling(result.transactionId);
        break;
        
      case 'ERROR':
        logError(result);
        showGenericError();
        break;
    }
  },
  
  onError: function(error) {
    hideLoadingOverlay();
    logError(error);
    showErrorMessage(error.errorDescription);
  },
  
  // ===== FORM EVENTS =====
  
  onFormValidated: function(isValid) {
    document.getElementById('submit-btn').disabled = !isValid;
  },
  
  onPaymentFormChange: function(fieldData) {
    if (fieldData.fieldName === 'cardNumber' && fieldData.cardBrand) {
      updateCardBrandIcon(fieldData.cardBrand);
    }
  },
  
  // ===== SELECTION EVENTS =====
  
  onSelectPaymentMethod: function(pm) {
    analytics.track('PM Selected', { method: pm.paymentMethod });
    updatePaymentMethodUI(pm);
  },
  
  // ===== UPO EVENTS =====
  
  upoDeleted: function(upoId) {
    analytics.track('UPO Deleted', { upoId });
    syncWithBackend('delete', upoId);
  },
  
  // ===== 3DS EVENTS =====
  
  on3DSStarted: function(data) {
    showSecurityNotification();
  },
  
  on3DSComplete: function(data) {
    hideSecurityNotification();
    if (data.authenticationStatus === 'N') {
      console.warn('3DS authentication failed');
    }
  },
  
  // ===== APM EVENTS =====
  
  onAPMRedirectStarted: function(data) {
    saveOrderState();
    showRedirectMessage(data.paymentMethodName);
  },
  
  onAPMPopupClosed: function(data) {
    if (!data.completed) {
      showCancelledMessage();
    }
  },
  
  // ===== RECOVERY EVENTS =====
  
  onDeclineRecovery: function(data) {
    return {
      showRecovery: true,
      customMessage: 'Your payment was declined. Please try another method.'
    };
  }
});
```

---

## Next Steps

<CardGroup cols={2}>
  <Card title="Customization" icon="palette" href="/integrations/simply-connect/customization">
    All checkout() parameters
  </Card>
  <Card title="Methods" icon="code" href="/integrations/simply-connect/methods">
    Programmatic control
  </Card>
  <Card title="Webhooks" icon="webhook" href="/webhooks/overview">
    Server-side notifications
  </Card>
</CardGroup>
